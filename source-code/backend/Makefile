CC      := gcc
CSTD    := -std=c11
WARN    := -Wall -Wextra -Wpedantic
DEBUG   := -g
CFLAGS  := $(CSTD) $(WARN) $(DEBUG) -MMD -MP
LDFLAGS :=
LDLIBS  := -lm -lsqlite3

SRC_DIR := src
OBJ_DIR := build
BIN_DIR := bin
BIN     := $(BIN_DIR)/main

SRC := $(shell find $(SRC_DIR) -name '*.c')
OBJ := $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRC))
DEP := $(OBJ:.o=.d)

.PHONY: all run clean

all: $(BIN)

$(BIN): $(OBJ)
	@mkdir -p $(BIN_DIR)
	$(CC) $(LDFLAGS) $^ -o $@ $(LDLIBS)

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c
	@mkdir -p $(dir $@)
	$(CC) $(CFLAGS) -c $< -o $@

run: $(BIN)
	@cd $(BIN_DIR) && ./$(notdir $(BIN))

clean:
	rm -rf $(OBJ_DIR) $(BIN_DIR)

-include $(DEP)

# CC: C compiler
# CSTD: C language standard
# WARN: enable useful warnings
# DEBUG: debugging information
# CFLAGS: all compiler flags including dependency generation (-MMD, -MP)
# LDFLAGS: specifies how to link libraries
# LDLIBS: specifies which libraries to import
# SRC_DIR: directory for .c source files
# OBJ_DIR: directory for compiled .o files
# BIN_DIR: directory for final executable
# BIN: path to the final binary
# SRC: list of all .c files in SRC_DIR (including subfolders)
# OBJ: matching .o file paths for each .c file
# DEP: list of dependency files generated by -MMD
# .PHONY: declares non-file targets
# all: default target to build everything
# $(BIN): links all .o files into the final binary
# $(OBJ_DIR)/%.o: compiles each .c file into an .o file
# run: executes the program
# clean: removes OBJ_DIR and BIN_DIR
# -include $(DEP): includes auto-generated dependency files for incremental builds
