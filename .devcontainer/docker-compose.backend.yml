# LS-Tris Backend Compose file

name: ls-tris-backend-compose

services:

  backend:
    container_name: ls-tris-backend
    profiles: [prod] # This service will be started only in these profiles
    build:
      context: ../source-code/backend
      dockerfile: Dockerfile
    restart: unless-stopped
    ports: # Maps <hostPort>:<containerPort>
      - ${PROD_BACKEND_PORT:-55501}:5050
    volumes:
      - ../source-code/backend/db/data:/app/db/data # Mount <hostDir>:<containerDir>
    networks:
      - backend-network
  
  bridge:
    container_name: ls-tris-bridge
    profiles: [prod] # This service will be started only in these profiles
    build: 
      context: ../source-code/bridge
      dockerfile: Dockerfile 
    restart: unless-stopped
    ports: # Maps <hostPort>:<containerPort>
      - ${PROD_BRIDGE_HTTP_PORT:-55504}:3001
      - ${PROD_BRIDGE_WS_PORT:-55505}:3002
    depends_on:
      - backend
    environment:
      TCP_BACKEND_ADDRESS: ${TCP_BACKEND_ADDRESS:-backend} # The address inside the docker network
      TCP_BACKEND_PORT: 5050 # The port inside the docker network
    networks:
      - backend-network
    
networks:
  backend-network: